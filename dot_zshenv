# vim:ft=zsh foldmethod=marker

mkdir -p "${XDG_DATA_HOME:-$HOME/.local/share}/zsh"
mkdir -p "${XDG_STATE_HOME:-$HOME/.local/state}/zsh"
mkdir -p "${XDG_CACHE_HOME:-$HOME/.cache}/zsh"
mkdir -p "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/zfunc"

# Source environment.d {{{
if [[ -z "${ENVIRONMENTD_SOURCED:-}" ]]; then
  set -a
  for gen in /usr/lib/systemd/user-environment-generators/*; do
    if command -v "$gen" &>/dev/null; then
      source <("$gen")
    fi
  done
  set +a
  export ENVIRONMENTD_SOURCED=zsh
fi
# }}}

# EDITOR {{{
if command -v nvim &>/dev/null; then
  export EDITOR=nvim
elif command -v vim &>/dev/null; then
  export EDITOR=vim
elif command -v nano &>/dev/null; then
  export EDITOR=nano
fi
# }}}

# rtx {{{
if [[ ! -e "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/rtx" ]] && type rtx &>/dev/null; then
  rtx activate > "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/rtx"
fi
if [[ -e "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/rtx" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/rtx"
fi
# }}}

# PATH {{{
# Binaries installed via cargo
export PATH="$PATH:$CARGO_HOME/bin"

# Binaries installed via dotnet
export PATH="$PATH:$DOTNET_CLI_HOME/tools"

# User-local binaries should shadow system binaries
export PATH="$HOME/.local/bin:$PATH"
# }}}
